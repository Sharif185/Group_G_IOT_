{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid dashboard-container">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="dashboard-header">
                <div class="header-content">
                    <div class="header-main">
                        <h1 class="display-4">
                            <i class="fas fa-cloud-sun-rain me-3"></i>
                            Environmental Intelligence
                        </h1>
                        <p class="lead">Advanced Monitoring & AI-Powered Forecasting</p>
                    </div>
                    
                    <div class="current-time">
                        <div class="time-display" id="current-time">--:--:--</div>
                        <div class="date-display" id="current-date">-- --- ----</div>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stat-badge online">
                        <div class="pulse-dot"></div>
                        <i class="fas fa-satellite-dish me-2"></i>
                        Live Data
                    </div>
                    <div class="stat-badge updates">
                        <i class="fas fa-sync-alt me-2"></i>
                        <span id="update-counter">0</span> Updates
                    </div>
                    <div class="stat-badge predictions">
                        <i class="fas fa-brain me-2"></i>
                        AI Active and Learning
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Real-time Stats Row -->
    <div class="row mb-5">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="dashboard-card stat-card temperature-card">
                <div class="card-background"></div>
                <div class="card-glow"></div>
                <div class="card-content">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-thermometer-full"></i>
                            </div>
                        </div>
                        <div class="stat-trend" id="temp-trend">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                    </div>
                    <h4>Temperature</h4>
                    <div class="stat-value temperature" id="current-temp">--</div>
                    <div class="stat-range">
                        <span class="range-min">15°</span>
                        <div class="range-bar">
                            <div class="range-fill" id="temp-range-fill"></div>
                        </div>
                        <span class="range-max">35°</span>
                    </div>
                    <div class="stat-meta">
                        <i class="fas fa-clock me-2"></i>
                        <small id="temp-timestamp">Loading...</small>
                    </div>
                </div>
                <div class="card-wave"></div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="dashboard-card stat-card humidity-card">
                <div class="card-background"></div>
                <div class="card-glow"></div>
                <div class="card-content">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-tint"></i>
                            </div>
                        </div>
                        <div class="stat-trend" id="humidity-trend">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                    </div>
                    <h4>Humidity</h4>
                    <div class="stat-value humidity" id="current-humidity">--</div>
                    <div class="humidity-visual">
                        <div class="droplet-container">
                            <div class="droplet" style="--delay: 0s"></div>
                            <div class="droplet" style="--delay: 0.3s"></div>
                            <div class="droplet" style="--delay: 0.6s"></div>
                        </div>
                    </div>
                    <div class="stat-meta">
                        <i class="fas fa-clock me-2"></i>
                        <small id="humidity-timestamp">Loading...</small>
                    </div>
                </div>
                <div class="card-wave"></div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="dashboard-card stat-card battery-card">
                <div class="card-background"></div>
                <div class="card-glow"></div>
                <div class="card-content">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-battery-three-quarters"></i>
                            </div>
                        </div>
                        <div class="battery-visual">
                            <div class="battery-container">
                                <div class="battery-level">
                                    <div class="battery-fill" id="battery-fill"></div>
                                    <div class="battery-capacity" id="battery-capacity">--%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h4>Power System</h4>
                    <div class="stat-value battery" id="current-battery">--</div>
                    <div class="voltage-display">
                        <i class="fas fa-bolt me-2"></i>
                        <span id="battery-voltage">--</span>V
                    </div>
                    <div class="stat-meta">
                        <i class="fas fa-microchip me-2"></i>
                        <small>Sensor Power</small>
                    </div>
                </div>
                <div class="card-wave"></div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="dashboard-card stat-card motion-card">
                <div class="card-background"></div>
                <div class="card-glow"></div>
                <div class="card-content">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <div class="icon-wrapper">
                                <i class="fas fa-walking"></i>
                            </div>
                        </div>
                        <div class="motion-visual">
                            <div class="motion-indicator" id="motion-indicator">
                                <div class="radar-sweep"></div>
                                <div class="radar-dots">
                                    <div class="dot dot-1"></div>
                                    <div class="dot dot-2"></div>
                                    <div class="dot dot-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h4>Activity Monitor</h4>
                    <div class="stat-value motion" id="current-motion">--</div>
                    <div class="activity-status" id="activity-status">
                        <span class="status-dot"></span>
                        No Activity
                    </div>
                    <div class="stat-meta">
                        <i class="fas fa-history me-2"></i>
                        <small>Real-time Monitoring</small>
                    </div>
                </div>
                <div class="card-wave"></div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-5">
        <div class="col-lg-8 mb-4">
            <div class="dashboard-card chart-card main-chart">
                <div class="card-background"></div>
                <div class="card-header">
                    <div class="header-title">
                        <h4><i class="fas fa-chart-network me-2"></i>Environmental Trends Analysis</h4>
                        <span class="time-range">Last 24 Hours</span>
                    </div>
                    <div class="chart-controls">
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color temp-color"></div>
                                <span>Temperature (°C)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color humidity-color"></div>
                                <span>Humidity (%)</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="temperature-humidity-chart"></div>
                <div class="chart-stats">
                    <div class="stat-item">
                        <span class="stat-label">Avg Temp</span>
                        <span class="stat-value" id="avg-temp">--°C</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Avg Humidity</span>
                        <span class="stat-value" id="avg-humidity">--%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Data Points</span>
                        <span class="stat-value" id="data-points">--</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-4">
            <div class="dashboard-card chart-card secondary-chart">
                <div class="card-background"></div>
                <div class="card-header">
                    <h4><i class="fas fa-wind me-2"></i>Environmental Metrics</h4>
                </div>
                <div id="environmental-chart"></div>
                <div class="metric-cards">
                    <div class="metric-card heat-index">
                        <div class="metric-icon">
                            <i class="fas fa-temperature-high"></i>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">Heat Index</span>
                            <span class="metric-value" id="current-heat-index">--°C</span>
                        </div>
                    </div>
                    <div class="metric-card dew-point">
                        <div class="metric-icon">
                            <i class="fas fa-cloud-rain"></i>
                        </div>
                        <div class="metric-info">
                            <span class="metric-label">Dew Point</span>
                            <span class="metric-value" id="current-dew-point">--°C</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Predictions Section -->
    {% if predictions_available and temperature_predictions %}
    <!-- Predictions Row -->
    <div class="row mb-5">
        <div class="col-12 mb-4">
            <div class="section-header">
                <div class="section-title">
                    <h3><i class="fas fa-robot me-2"></i>AI Forecasting Engine</h3>
                    <p class="section-subtitle">Neural Network Predictions for Next 12 Hours</p>
                </div>
                <div class="section-badges">
                    <div class="tech-badge">
                        <i class="fas fa-microchip me-1"></i>
                        TensorFlow
                    </div>
                    <div class="tech-badge">
                        <i class="fas fa-chart-line me-1"></i>
                        LSTM Network
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card chart-card prediction-card temperature-prediction">
                <div class="card-background"></div>
                <div class="card-header">
                    <div class="prediction-title">
                        <h4><i class="fas fa-fire me-2"></i>Temperature Forecast</h4>
                        <div class="prediction-badge">
                            <i class="fas fa-brain me-1"></i>
                            94% Accuracy
                        </div>
                    </div>
                    <div class="prediction-range">
                        <span id="temp-prediction-range">--°C to --°C</span>
                    </div>
                </div>
                <div id="temperature-predictions-chart"></div>
                <div class="prediction-insights">
                    <div class="insight-item">
                        <i class="fas fa-arrow-up text-danger me-2"></i>
                        <span>Peak at <strong id="temp-peak-time">--:--</strong></span>
                    </div>
                    <div class="insight-item">
                        <i class="fas fa-arrow-down text-primary me-2"></i>
                        <span>Low at <strong id="temp-low-time">--:--</strong></span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="dashboard-card chart-card prediction-card humidity-prediction">
                <div class="card-background"></div>
                <div class="card-header">
                    <div class="prediction-title">
                        <h4><i class="fas fa-cloud-rain me-2"></i>Humidity Forecast</h4>
                        <div class="prediction-badge">
                            <i class="fas fa-brain me-1"></i>
                            89% Accuracy
                        </div>
                    </div>
                    <div class="prediction-range">
                        <span id="humidity-prediction-range">--% to --%</span>
                    </div>
                </div>
                <div id="humidity-predictions-chart"></div>
                <div class="prediction-insights">
                    <div class="insight-item">
                        <i class="fas fa-tint text-primary me-2"></i>
                        <span>Stable pattern detected</span>
                    </div>
                    <div class="insight-item">
                        <i class="fas fa-chart-line text-info me-2"></i>
                        <span>Gradual decrease expected</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Predictions Data Table -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="dashboard-card table-card">
                <div class="card-background"></div>
                <div class="card-header">
                    <h4><i class="fas fa-table me-2"></i>Detailed Forecast Analysis</h4>
                    <div class="table-actions">
                        <button class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-download me-1"></i> Export
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="prediction-table">
                        <thead>
                            <tr>
                                <th class="time-col">Time</th>
                                <th class="metric-col">Temperature</th>
                                <th class="confidence-col">Confidence</th>
                                <th class="metric-col">Humidity</th>
                                <th class="confidence-col">Confidence</th>
                                <th class="trend-col">Trend</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for i in temperature_predictions %}
                            <tr>
                                <td class="time-cell">
                                    <i class="fas fa-clock me-2"></i>
                                    {{ i.prediction_for|date:"H:i" }}
                                </td>
                                <td class="temp-cell">
                                    <div class="metric-with-icon">
                                        <i class="fas fa-thermometer-half me-2"></i>
                                        {{ i.predicted_value }}°C
                                    </div>
                                </td>
                                <td>
                                    <div class="confidence-widget">
                                        <div class="confidence-bar">
                                            <div class="confidence-fill bg-gradient-success" 
                                                 style="width: {{ i.confidence|default:0|floatformat:0 }}%">
                                                <span class="confidence-text">{{ i.confidence|default:0|floatformat:0 }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="humidity-cell">
                                    <div class="metric-with-icon">
                                        <i class="fas fa-tint me-2"></i>
                                        {% for hum_pred in humidity_predictions %}
                                            {% if hum_pred.prediction_for == i.prediction_for %}
                                                {{ hum_pred.predicted_value }}%
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </td>
                                <td>
                                    <div class="confidence-widget">
                                        <div class="confidence-bar">
                                            <div class="confidence-fill bg-gradient-info" 
                                                 style="width: {{ hum_pred.confidence|default:0|floatformat:0 }}%">
                                                <span class="confidence-text">{{ hum_pred.confidence|default:0|floatformat:0 }}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <td class="trend-cell">
                                    <div class="trend-indicator">
                                        <i class="fas fa-arrow-up text-success"></i>
                                        <span class="trend-text">Rising</span>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- Fallback when no predictions available -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="dashboard-card info-card">
                <div class="card-background"></div>
                <div class="card-body">
                    <div class="info-content">
                        <div class="info-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="info-text">
                            <h5>AI Forecasting System</h5>
                            <p>Advanced machine learning predictions activated when sufficient environmental data is collected.</p>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="status-panel">
                                <h6>System Status</h6>
                                <div class="status-grid">
                                    <div class="status-card ready">
                                        <div class="status-icon">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div class="status-info">
                                            <span class="status-title">Prediction Engine</span>
                                            <span class="status-value">Ready</span>
                                        </div>
                                    </div>
                                    <div class="status-card collecting">
                                        <div class="status-icon">
                                            <i class="fas fa-database"></i>
                                        </div>
                                        <div class="status-info">
                                            <span class="status-title">Data Collection</span>
                                            <span class="status-value">In Progress</span>
                                        </div>
                                    </div>
                                    <div class="status-card training">
                                        <div class="status-icon">
                                            <i class="fas fa-graduation-cap"></i>
                                        </div>
                                        <div class="status-info">
                                            <span class="status-title">Model Training</span>
                                            <span class="status-value">Pending Data</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="features-panel">
                                <h6>AI Capabilities</h6>
                                <div class="features-list">
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <i class="fas fa-thermometer-three-quarters"></i>
                                        </div>
                                        <div class="feature-text">
                                            <strong>Temperature Forecasting</strong>
                                            <span>12-hour predictions with confidence scores</span>
                                        </div>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <i class="fas fa-cloud-rain"></i>
                                        </div>
                                        <div class="feature-text">
                                            <strong>Humidity Trends</strong>
                                            <span>Pattern-based humidity predictions</span>
                                        </div>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <i class="fas fa-chart-network"></i>
                                        </div>
                                        <div class="feature-text">
                                            <strong>Smart Analytics</strong>
                                            <span>Multi-variable correlation analysis</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="activation-panel text-center mt-4">
                        <button class="btn btn-primary btn-lg activation-btn" onclick="generateSamplePredictions(this)">
                            <i class="fas fa-rocket me-2"></i> Activate AI Forecasting
                        </button>
                        <p class="mt-2 text-muted">Generate sample predictions to experience the AI system</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- System Status Row -->
    <div class="row">
        <div class="col-12">
            <div class="dashboard-card status-card">
                <div class="card-background"></div>
                <div class="card-header">
                    <h4><i class="fas fa-heartbeat me-2"></i>System Health Monitor</h4>
                    <div class="health-score">
                        <div class="score-circle">
                            <span class="score-value" id="health-score">100%</span>
                        </div>
                    </div>
                </div>
                <div id="alerts-container">
                    <div class="alert alert-success system-alert" role="alert">
                        <div class="alert-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="alert-content">
                            <h6>All Systems Optimal</h6>
                            <p>Environmental monitoring system operating at peak performance with real-time data streaming.</p>
                        </div>
                        <div class="alert-meta">
                            <div class="alert-time" id="system-alert-time">Just now</div>
                            <div class="alert-indicator">
                                <div class="pulse-dot"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Floating Action Buttons -->
<div class="fab-container">
    <div class="fab-group">
        <button class="fab btn btn-primary fab-main" onclick="testRealTimeUpdate()" title="Refresh Data">
            <i class="fas fa-sync-alt"></i>
        </button>
        <button class="fab btn btn-info fab-option" onclick="updateCharts()" title="Update Charts">
            <i class="fas fa-chart-bar"></i>
        </button>
        <button class="fab btn btn-success fab-option" onclick="exportData()" title="Export Data">
            <i class="fas fa-download"></i>
        </button>
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loading-overlay">
    <div class="loading-content">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <div class="loading-text">
            <h5>Initializing Dashboard</h5>
            <p>Loading real-time environmental data...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Ultimate Professional Dashboard Styling */
:root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    --info-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    --dark-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
    
    --temperature-gradient: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
    --humidity-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --battery-gradient: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%);
    --motion-gradient: linear-gradient(135deg, #ffd3b6 0%, #ffaaa5 100%);
    
    --card-bg: rgba(255, 255, 255, 0.95);
    --card-border: rgba(255, 255, 255, 0.2);
    --text-dark: #2d3748;
    --text-light: #718096;
    --text-lighter: #a0aec0;
    
    --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
    --shadow-medium: 0 8px 40px rgba(0, 0, 0, 0.12);
    --shadow-strong: 0 16px 60px rgba(0, 0, 0, 0.15);
    --shadow-glow: 0 0 40px rgba(102, 126, 234, 0.15);
}

* {
    box-sizing: border-box;
}

.dashboard-container {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    padding: 30px;
    position: relative;
    overflow-x: hidden;
}

.dashboard-container::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
}

/* Header Styling */
.dashboard-header {
    background: var(--card-bg);
    border-radius: 25px;
    padding: 2.5rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-medium);
    backdrop-filter: blur(20px);
    border: 1px solid var(--card-border);
    position: relative;
    overflow: hidden;
    z-index: 1;
}

.dashboard-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary-gradient);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.header-main h1 {
    font-weight: 800;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
    font-size: 2.8rem;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.header-main .lead {
    color: var(--text-light);
    font-size: 1.2rem;
    font-weight: 500;
}

.current-time {
    text-align: right;
}

.time-display {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--text-dark);
    font-family: 'Courier New', monospace;
}

.date-display {
    font-size: 1rem;
    color: var(--text-light);
    font-weight: 500;
}

.header-stats {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
}

.stat-badge {
    padding: 0.75rem 1.5rem;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.stat-badge::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
}

.stat-badge:hover::before {
    left: 100%;
}

.stat-badge.online {
    background: var(--success-gradient);
    color: white;
    box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
}

.stat-badge.updates {
    background: var(--card-bg);
    color: var(--text-dark);
    box-shadow: var(--shadow-soft);
}

.stat-badge.predictions {
    background: var(--info-gradient);
    color: white;
    box-shadow: 0 4px 15px rgba(67, 233, 123, 0.3);
}

.pulse-dot {
    width: 8px;
    height: 8px;
    background: #4ade80;
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 2s infinite;
}

/* Card Styling - Ultimate Enhancement */
.dashboard-card {
    background: var(--card-bg);
    border-radius: 25px;
    box-shadow: var(--shadow-medium);
    backdrop-filter: blur(20px);
    border: 1px solid var(--card-border);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    overflow: hidden;
    position: relative;
    z-index: 1;
}

.dashboard-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: var(--shadow-strong), var(--shadow-glow);
}

.card-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: -1;
}

.dashboard-card:hover .card-background {
    opacity: 1;
}

.temperature-card .card-background {
    background: var(--temperature-gradient);
}

.humidity-card .card-background {
    background: var(--humidity-gradient);
}

.battery-card .card-background {
    background: var(--battery-gradient);
}

.motion-card .card-background {
    background: var(--motion-gradient);
}

.card-glow {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary-gradient);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.dashboard-card:hover .card-glow {
    opacity: 1;
}

.card-wave {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
    animation: wave 3s ease-in-out infinite;
}

@keyframes wave {
    0%, 100% { transform: translateX(-100%); }
    50% { transform: translateX(100%); }
}

/* Stat Card Content */
.stat-card {
    padding: 2rem;
    height: 100%;
    position: relative;
    z-index: 2;
}

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.icon-wrapper {
    width: 70px;
    height: 70px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    background: rgba(255, 255, 255, 0.9);
    box-shadow: var(--shadow-soft);
    backdrop-filter: blur(10px);
}

.temperature-card .icon-wrapper {
    color: #ff6b6b;
    background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 167, 38, 0.1) 100%);
}

.humidity-card .icon-wrapper {
    color: #4facfe;
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%);
}

.battery-card .icon-wrapper {
    color: #a8e6cf;
    background: linear-gradient(135deg, rgba(168, 230, 207, 0.1) 0%, rgba(220, 237, 193, 0.1) 100%);
}

.motion-card .icon-wrapper {
    color: #ffd3b6;
    background: linear-gradient(135deg, rgba(255, 211, 182, 0.1) 0%, rgba(255, 170, 165, 0.1) 100%);
}

.stat-trend {
    font-size: 1.5rem;
    padding: 0.5rem;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.8);
    box-shadow: var(--shadow-soft);
}

.stat-trend .fa-arrow-up { color: #e74c3c; }
.stat-trend .fa-arrow-down { color: #3498db; }
.stat-trend .fa-minus { color: var(--text-light); }

.stat-card h4 {
    color: var(--text-light);
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin-bottom: 0.5rem;
}

.stat-value {
    font-size: 3rem;
    font-weight: 800;
    color: var(--text-dark);
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--text-dark) 0%, var(--text-light) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Enhanced Visual Elements */
.stat-range {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.range-bar {
    flex: 1;
    height: 6px;
    background: rgba(0, 0, 0, 0.1);
    border-radius: 3px;
    overflow: hidden;
}

.range-fill {
    height: 100%;
    background: var(--temperature-gradient);
    border-radius: 3px;
    transition: width 0.5s ease;
}

.range-min, .range-max {
    font-size: 0.8rem;
    color: var(--text-light);
    font-weight: 600;
}

/* Humidity Droplets */
.humidity-visual {
    margin: 1rem 0;
}

.droplet-container {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
}

.droplet {
    width: 12px;
    height: 12px;
    background: var(--humidity-gradient);
    border-radius: 50% 50% 50% 0;
    transform: rotate(-45deg);
    animation: droplet-fall 2s ease-in-out infinite;
    animation-delay: var(--delay);
}

@keyframes droplet-fall {
    0%, 100% { transform: rotate(-45deg) translateY(0); opacity: 0.7; }
    50% { transform: rotate(-45deg) translateY(10px); opacity: 1; }
}

/* Battery Visual Enhancement */
.battery-visual {
    margin-left: 1rem;
}

.battery-container {
    display: flex;
    align-items: center;
}

.battery-level {
    width: 60px;
    height: 30px;
    border: 2px solid var(--text-light);
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    background: rgba(0, 0, 0, 0.05);
}

.battery-level::after {
    content: '';
    position: absolute;
    right: -6px;
    top: 8px;
    width: 4px;
    height: 14px;
    background: var(--text-light);
    border-radius: 0 4px 4px 0;
}

.battery-fill {
    height: 100%;
    background: var(--battery-gradient);
    border-radius: 6px;
    transition: width 0.5s ease;
    position: relative;
    overflow: hidden;
}

.battery-fill::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    animation: shine 2s ease-in-out infinite;
}

@keyframes shine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.battery-capacity {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--text-dark);
    text-shadow: 0 1px 2px rgba(255,255,255,0.8);
}

/* Motion Radar */
.motion-visual {
    margin-left: 1rem;
}

.motion-indicator {
    width: 50px;
    height: 50px;
    border: 2px solid rgba(255, 211, 182, 0.6);
    border-radius: 50%;
    position: relative;
}

.radar-sweep {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: conic-gradient(transparent, rgba(255, 170, 165, 0.8), transparent);
    animation: radar-sweep 2s linear infinite;
}

@keyframes radar-sweep {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.radar-dots {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
}

.dot {
    position: absolute;
    width: 6px;
    height: 6px;
    background: #ff6b6b;
    border-radius: 50%;
    transform: scale(0);
    animation: dot-pulse 2s ease-in-out infinite;
}

.dot-1 { top: 20%; left: 20%; animation-delay: 0s; }
.dot-2 { top: 60%; left: 70%; animation-delay: 0.7s; }
.dot-3 { top: 30%; left: 80%; animation-delay: 1.4s; }

@keyframes dot-pulse {
    0%, 100% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1); opacity: 1; }
}

.motion-active .dot {
    animation: dot-pulse-active 1s ease-in-out infinite;
}

@keyframes dot-pulse-active {
    0%, 100% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1.2); opacity: 1; }
}

.activity-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 1rem 0;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 25px;
    font-weight: 600;
    font-size: 0.9rem;
}

.status-dot {
    width: 8px;
    height: 8px;
    background: #27ae60;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.motion-active .status-dot {
    background: #e74c3c;
    animation: pulse 0.5s infinite;
}

.stat-meta {
    color: var(--text-light);
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    margin-top: 1rem;
}

.voltage-display {
    display: flex;
    align-items: center;
    margin: 0.5rem 0;
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 20px;
    font-weight: 600;
    color: var(--text-dark);
}

/* Chart Cards Enhancement */
.chart-card {
    padding: 2rem;
    position: relative;
}

.chart-card .card-background {
    background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.header-title h4 {
    color: var(--text-dark);
    font-weight: 700;
    margin: 0;
    font-size: 1.3rem;
}

.time-range {
    font-size: 0.9rem;
    color: var(--text-light);
    background: rgba(0, 0, 0, 0.05);
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
}

.chart-legend {
    display: flex;
    gap: 1.5rem;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: var(--text-dark);
    font-weight: 500;
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
}

.temp-color { background: var(--temperature-gradient); }
.humidity-color { background: var(--humidity-gradient); }

.chart-stats {
    display: flex;
    gap: 2rem;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.stat-item {
    text-align: center;
}

.stat-label {
    display: block;
    font-size: 0.8rem;
    color: var(--text-light);
    margin-bottom: 0.25rem;
}

.stat-item .stat-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin: 0;
}

/* Metric Cards */
.metric-cards {
    display: grid;
    gap: 1rem;
    margin-top: 1.5rem;
}

.metric-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 15px;
    border-left: 4px solid;
    transition: transform 0.3s ease;
}

.metric-card:hover {
    transform: translateX(5px);
}

.heat-index { border-left-color: #ff6b6b; }
.dew-point { border-left-color: #4facfe; }

.metric-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    background: rgba(0, 0, 0, 0.05);
}

.heat-index .metric-icon { color: #ff6b6b; }
.dew-point .metric-icon { color: #4facfe; }

.metric-info {
    flex: 1;
}

.metric-label {
    display: block;
    font-size: 0.8rem;
    color: var(--text-light);
    margin-bottom: 0.25rem;
}

.metric-value {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-dark);
}

/* Prediction Cards */
.prediction-card {
    border-left: 6px solid;
}

.temperature-prediction { border-left-color: #ff6b6b; }
.humidity-prediction { border-left-color: #4facfe; }

.prediction-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.prediction-title h4 {
    margin: 0;
    color: var(--text-dark);
    font-weight: 700;
}

.prediction-badge {
    background: var(--primary-gradient);
    color: white;
    padding: 0.4rem 1rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.prediction-range {
    font-size: 0.9rem;
    color: var(--text-light);
    font-weight: 500;
}

.prediction-insights {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.insight-item {
    display: flex;
    align-items: center;
    font-size: 0.85rem;
    color: var(--text-dark);
    font-weight: 500;
}

/* Table Enhancement */
.table-card {
    padding: 2rem;
}

.table-card .card-header {
    margin-bottom: 1.5rem;
}

.table-actions {
    display: flex;
    gap: 0.5rem;
}

.prediction-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
}

.prediction-table th {
    background: rgba(248, 250, 252, 0.8);
    color: var(--text-light);
    font-weight: 600;
    padding: 1.2rem 1rem;
    text-align: left;
    border-bottom: 2px solid #e2e8f0;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.prediction-table td {
    padding: 1.2rem 1rem;
    border-bottom: 1px solid #f1f5f9;
    color: var(--text-dark);
    transition: background-color 0.3s ease;
}

.prediction-table tr:hover td {
    background: rgba(79, 172, 254, 0.05);
}

.time-cell, .temp-cell, .humidity-cell {
    font-weight: 600;
}

.metric-with-icon {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.confidence-widget {
    min-width: 120px;
}

.confidence-bar {
    width: 100%;
    height: 24px;
    background: #f1f5f9;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.confidence-fill {
    height: 100%;
    border-radius: 12px;
    transition: width 0.5s ease;
    position: relative;
    overflow: hidden;
}

.bg-gradient-success {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.bg-gradient-info {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.confidence-text {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    font-size: 0.7rem;
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.trend-cell {
    text-align: center;
}

.trend-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    justify-content: center;
}

.trend-text {
    font-size: 0.8rem;
    font-weight: 600;
}

/* Info Card Enhancement */
.info-card .card-body {
    padding: 3rem;
}

.info-content {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
}

.info-icon {
    font-size: 4rem;
    color: #667eea;
    opacity: 0.8;
}

.info-text h5 {
    color: var(--text-dark);
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.info-text p {
    color: var(--text-light);
    font-size: 1.1rem;
    margin: 0;
}

.status-panel, .features-panel {
    margin-bottom: 2rem;
}

.status-panel h6, .features-panel h6 {
    color: var(--text-dark);
    font-weight: 600;
    margin-bottom: 1rem;
    font-size: 1.1rem;
}

.status-grid {
    display: grid;
    gap: 1rem;
}

.status-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.2rem;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 15px;
    border-left: 4px solid;
    transition: transform 0.3s ease;
}

.status-card:hover {
    transform: translateX(5px);
}

.status-card.ready { border-left-color: #27ae60; }
.status-card.collecting { border-left-color: #f39c12; }
.status-card.training { border-left-color: #3498db; }

.status-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    background: rgba(0, 0, 0, 0.05);
}

.ready .status-icon { color: #27ae60; }
.collecting .status-icon { color: #f39c12; }
.training .status-icon { color: #3498db; }

.status-info {
    flex: 1;
}

.status-title {
    display: block;
    font-size: 0.9rem;
    color: var(--text-light);
    margin-bottom: 0.25rem;
}

.status-value {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-dark);
}

.features-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.feature-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.2rem;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 15px;
    transition: transform 0.3s ease;
}

.feature-item:hover {
    transform: translateX(5px);
}

.feature-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
}

.feature-text {
    flex: 1;
}

.feature-text strong {
    display: block;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
}

.feature-text span {
    font-size: 0.9rem;
    color: var(--text-light);
}

.activation-panel {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    padding: 2rem;
    border-radius: 20px;
    border: 2px dashed rgba(102, 126, 234, 0.3);
}

.activation-btn {
    background: var(--primary-gradient);
    border: none;
    padding: 1rem 2rem;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 25px;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    transition: all 0.3s ease;
}

.activation-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
}

/* System Status Card */
.status-card .card-header {
    margin-bottom: 1.5rem;
}

.health-score {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.score-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: conic-gradient(#4ade80 0% 100%, #e2e8f0 100% 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.score-circle::before {
    content: '';
    position: absolute;
    width: 50px;
    height: 50px;
    background: var(--card-bg);
    border-radius: 50%;
}

.score-value {
    position: relative;
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--text-dark);
}

.system-alert {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 1.5rem;
    border: none;
    border-radius: 20px;
    margin: 0;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
}

.alert-icon {
    font-size: 2.5rem;
    opacity: 0.8;
}

.alert-success .alert-icon { color: #27ae60; }
.alert-warning .alert-icon { color: #f39c12; }
.alert-info .alert-icon { color: #3498db; }

.alert-content {
    flex: 1;
}

.alert-content h6 {
    margin: 0 0 0.5rem 0;
    font-weight: 700;
    color: var(--text-dark);
    font-size: 1.1rem;
}

.alert-content p {
    margin: 0;
    color: var(--text-light);
    font-size: 0.95rem;
}

.alert-meta {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.5rem;
}

.alert-time {
    color: var(--text-light);
    font-size: 0.85rem;
    font-weight: 500;
}

.alert-indicator .pulse-dot {
    margin: 0;
    animation: pulse 2s infinite;
}

/* Floating Action Buttons */
.fab-container {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 1000;
}

.fab-group {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
}

.fab {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: none;
    position: relative;
    overflow: hidden;
}

.fab::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.fab:hover::before {
    opacity: 1;
}

.fab-main {
    background: var(--primary-gradient);
    color: white;
    z-index: 10;
}

.fab-option {
    transform: scale(0);
    opacity: 0;
}

.fab-group:hover .fab-option {
    transform: scale(1);
    opacity: 1;
}

.fab-option:nth-child(2) { transition-delay: 0.1s; }
.fab-option:nth-child(3) { transition-delay: 0.2s; }

.fab:hover {
    transform: scale(1.1);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
}

.fab-main:hover {
    transform: scale(1.1) rotate(180deg);
}

/* Loading Overlay */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    backdrop-filter: blur(10px);
}

.loading-content {
    text-align: center;
    color: white;
}

.loading-spinner {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    justify-content: center;
}

.spinner-ring {
    width: 20px;
    height: 20px;
    border: 3px solid transparent;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.spinner-ring:nth-child(2) {
    border-top-color: #764ba2;
    animation-delay: 0.2s;
}

.spinner-ring:nth-child(3) {
    border-top-color: #4facfe;
    animation-delay: 0.4s;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-text h5 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.loading-text p {
    color: #cbd5e1;
    font-size: 1rem;
}

/* Section Headers */
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.section-title h3 {
    color: var(--text-dark);
    font-weight: 800;
    margin-bottom: 0.5rem;
    font-size: 2rem;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.section-subtitle {
    color: var(--text-light);
    font-size: 1.1rem;
}

.section-badges {
    display: flex;
    gap: 1rem;
}

.tech-badge {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-dark);
    border: 1px solid rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(10px);
}

/* Animation Classes */
.value-changing {
    opacity: 0.6;
    transform: scale(0.95);
    transition: all 0.3s ease;
    background-color: rgba(255, 193, 7, 0.2) !important;
}

.value-changed {
    animation: realtimePulse 1.5s ease-in-out;
    background-color: rgba(40, 167, 69, 0.15) !important;
    border-radius: 6px;
    padding: 2px 8px;
}

.value-increased {
    color: #e74c3c !important;
    background-color: rgba(231, 76, 60, 0.1) !important;
}

.value-decreased {
    color: #3498db !important;
    background-color: rgba(52, 152, 219, 0.1) !important;
}

.value-error {
    animation: shake 0.5s ease-in-out;
    color: #e74c3c !important;
    background-color: rgba(231, 76, 60, 0.1) !important;
}

.motion-active {
    color: #e74c3c !important;
    font-weight: bold;
    background-color: rgba(231, 76, 60, 0.1) !important;
}

.motion-inactive {
    color: #27ae60 !important;
    background-color: rgba(39, 174, 96, 0.1) !important;
}

.alert-slide-in {
    animation: slideInFromTop 0.5s ease-out;
}

@keyframes realtimePulse {
    0% { 
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
    }
    50% { 
        transform: scale(1.02);
        box-shadow: 0 0 0 15px rgba(40, 167, 69, 0);
    }
    100% { 
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
    }
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

@keyframes slideInFromTop {
    0% {
        transform: translateY(-20px);
        opacity: 0;
    }
    100% {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.7; }
}

/* Responsive Design */
@media (max-width: 768px) {
    .dashboard-container {
        padding: 15px;
    }
    
    .dashboard-header {
        flex-direction: column;
        text-align: center;
        gap: 1.5rem;
        padding: 2rem 1.5rem;
    }
    
    .header-content {
        flex-direction: column;
        gap: 1rem;
    }
    
    .header-main h1 {
        font-size: 2.2rem;
    }
    
    .header-stats {
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .stat-value {
        font-size: 2.5rem;
    }
    
    .info-content {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .info-icon {
        font-size: 3rem;
    }
    
    .section-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .section-badges {
        justify-content: center;
    }
    
    .fab-container {
        bottom: 1rem;
        right: 1rem;
    }
    
    .fab {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
    }
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--primary-gradient);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a45a1 100%);
}
</style>
{% endblock %}

{% block scripts %}
    {# Expose prediction data safely to JS using Django's json_script filter #}
    {% if predictions_available %}
        {{ predictions_available|json_script:"predictions_available" }}
    {% else %}
        <script id="predictions_available" type="application/json">false</script>
    {% endif %}

    {% if temperature_predictions %}
        {{ temperature_predictions|json_script:"temperature_predictions" }}
    {% else %}
        <script id="temperature_predictions" type="application/json">[]</script>
    {% endif %}

    {% if humidity_predictions %}
        {{ humidity_predictions|json_script:"humidity_predictions" }}
    {% else %}
        <script id="humidity_predictions" type="application/json">[]</script>
    {% endif %}

<script>
    console.log('🚀 Ultimate Professional Dashboard loaded');

    let updateCount = 0;
    let lastValues = {
        temperature: null,
        humidity: null, 
        battery: null,
        motion: null,
        timestamp: null
    };

    // Update counter display
    function updateCounter() {
        const counter = document.getElementById('update-counter');
        if (counter) {
            counter.textContent = updateCount;
        }
    }

    // Update current time
    function updateCurrentTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString();
        const dateString = now.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        
        document.getElementById('current-time').textContent = timeString;
        document.getElementById('current-date').textContent = dateString;
    }

    // Global function for debug button
    window.testRealTimeUpdate = function() {
        console.log('🧪 Manual refresh triggered');
        updateCurrentStats(true);
    };

    // Export data function
    window.exportData = function() {
        alert('Export functionality would be implemented here!');
    };

    // Real-time data update
    function updateCurrentStats(isManual = false) {
        const startTime = Date.now();
        
        fetch('/api/current-stats/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                const responseTime = Date.now() - startTime;
                
                if (data && data.temperature !== undefined) {
                    // Check if this is the first load
                    const isFirstLoad = lastValues.temperature === null;
                    
                    // Check what changed
                    const changes = {
                        temperature: data.temperature !== lastValues.temperature,
                        humidity: data.humidity !== lastValues.humidity,
                        battery: data.battery_percentage !== lastValues.battery,
                        motion: data.motion !== lastValues.motion
                    };
                    
                    const anyChange = Object.values(changes).some(change => change);
                    
                    if (!isManual) {
                        updateCount++;
                        updateCounter();
                    }
                    
                    // Update cards with animation if changed
                    updateCardWithChange('current-temp', data.temperature + '°C', data.temperature, lastValues.temperature, changes.temperature, isFirstLoad, 'temp');
                    updateCardWithChange('current-humidity', data.humidity + '%', data.humidity, lastValues.humidity, changes.humidity, isFirstLoad, 'humidity');
                    updateCardWithChange('current-battery', data.battery_percentage + '%', data.battery_percentage, lastValues.battery, changes.battery, isFirstLoad, 'battery');
                    
                    const motionValue = data.motion ? 'Active' : 'Inactive';
                    updateCardWithChange('current-motion', motionValue, motionValue, lastValues.motion, changes.motion, isFirstLoad, 'motion');
                    
                    // Update battery voltage and visual
                    const batteryVoltageEl = document.getElementById('battery-voltage');
                    if (batteryVoltageEl) batteryVoltageEl.textContent = data.battery_voltage;
                    
                    // Update battery fill and capacity
                    const batteryFill = document.getElementById('battery-fill');
                    const batteryCapacity = document.getElementById('battery-capacity');
                    if (batteryFill) {
                        batteryFill.style.width = data.battery_percentage + '%';
                    }
                    if (batteryCapacity) {
                        batteryCapacity.textContent = data.battery_percentage + '%';
                    }
                    
                    // Update temperature range
                    const tempRangeFill = document.getElementById('temp-range-fill');
                    if (tempRangeFill) {
                        const tempPercentage = ((data.temperature - 15) / (35 - 15)) * 100;
                        tempRangeFill.style.width = Math.max(0, Math.min(100, tempPercentage)) + '%';
                    }
                    
                    // Update motion styling and indicator
                    const motionEl = document.getElementById('current-motion');
                    const motionIndicator = document.getElementById('motion-indicator');
                    const activityStatus = document.getElementById('activity-status');
                    if (motionEl) {
                        motionEl.className = 'stat-value motion ' + (data.motion ? 'motion-active' : 'motion-inactive');
                    }
                    if (motionIndicator) {
                        motionIndicator.className = 'motion-indicator ' + (data.motion ? 'motion-active' : '');
                    }
                    if (activityStatus) {
                        activityStatus.innerHTML = data.motion ? 
                            '<span class="status-dot"></span> Activity Detected' :
                            '<span class="status-dot"></span> No Activity';
                    }

                    // Update timestamps
                    if (data.timestamp) {
                        const timestamp = new Date(data.timestamp).toLocaleTimeString();
                        document.getElementById('temp-timestamp').textContent = timestamp;
                        document.getElementById('humidity-timestamp').textContent = timestamp;
                    }

                    // Update additional metrics
                    if (data.heat_index) {
                        document.getElementById('current-heat-index').textContent = data.heat_index + '°C';
                    }
                    if (data.dew_point) {
                        document.getElementById('current-dew-point').textContent = data.dew_point + '°C';
                    }

                    // Update alert based on temperature
                    updateAlertStatus(data);
                    
                    // Show visual feedback for changes
                    if (anyChange && !isFirstLoad) {
                        showRealTimeUpdateIndicator(changes);
                    }
                    
                    // Store current values
                    lastValues = {
                        temperature: data.temperature,
                        humidity: data.humidity,
                        battery: data.battery_percentage,
                        motion: data.motion,
                        timestamp: data.timestamp
                    };
                }
            })
            .catch(error => {
                console.error('❌ Error fetching current stats:', error);
                // Show error state
                document.querySelectorAll('.stat-value').forEach(el => {
                    if (el.textContent === '--') return;
                    el.classList.add('value-error');
                    setTimeout(() => el.classList.remove('value-error'), 2000);
                });
            });
    }

    // Update card with change detection and value comparison
    function updateCardWithChange(elementId, newText, newValue, oldValue, changed, isFirstLoad, type) {
        const element = document.getElementById(elementId);
        if (!element) return;

        const currentText = element.textContent;
        
        if (changed && !isFirstLoad) {
            element.classList.add('value-changing');
            
            setTimeout(() => {
                element.textContent = newText;
                element.classList.remove('value-changing');
                element.classList.add('value-changed');
                
                // Update trend indicators
                updateTrendIndicator(type, newValue, oldValue);
                
                // Add specific class based on value change direction
                if (type === 'temp' || type === 'humidity' || type === 'battery') {
                    if (newValue > oldValue) {
                        element.classList.add('value-increased');
                    } else if (newValue < oldValue) {
                        element.classList.add('value-decreased');
                    }
                }
                
                setTimeout(() => {
                    element.classList.remove('value-changed', 'value-increased', 'value-decreased');
                }, 1500);
                
            }, 300);
        } else if (currentText === '--' || currentText === 'Loading...') {
            // Initial load, just set the value without animation
            element.textContent = newText;
        } else {
            element.textContent = newText;
        }
    }

    // Update trend indicators
    function updateTrendIndicator(type, newValue, oldValue) {
        const trendElement = document.getElementById(type + '-trend');
        if (!trendElement || oldValue === null) return;
        
        const icon = trendElement.querySelector('i');
        if (newValue > oldValue) {
            icon.className = 'fas fa-arrow-up';
            trendElement.style.color = '#e74c3c';
        } else if (newValue < oldValue) {
            icon.className = 'fas fa-arrow-down';
            trendElement.style.color = '#3498db';
        } else {
            icon.className = 'fas fa-minus';
            trendElement.style.color = 'var(--text-light)';
        }
    }

    // Update alert status
    function updateAlertStatus(data) {
        const alertsContainer = document.getElementById('alerts-container');
        if (!alertsContainer) return;

        let alertClass = 'alert-success';
        let alertIcon = 'fa-check-circle';
        let alertTitle = 'All Systems Optimal';
        let alertMessage = 'Environmental monitoring system operating at peak performance with real-time data streaming.';

        if (data.temp_alert || data.temperature > 30) {
            alertClass = data.temp_alert ? 'alert-warning' : 'alert-info';
            alertIcon = data.temp_alert ? 'fa-exclamation-triangle' : 'fa-info-circle';
            alertTitle = data.temp_alert ? 'High Temperature Alert' : 'Temperature Advisory';
            alertMessage = data.temp_alert ? 
                `High temperature alert! Current temperature: ${data.temperature}°C - System monitoring closely.` :
                `Temperature is elevated: ${data.temperature}°C - Continue monitoring conditions.`;
        }

        // Only update if the alert message changed
        const currentAlert = alertsContainer.querySelector('.alert');
        if (!currentAlert || !currentAlert.textContent.includes(alertMessage)) {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            alertsContainer.innerHTML = `
                <div class="alert ${alertClass} system-alert alert-update" role="alert">
                    <div class="alert-icon">
                        <i class="fas ${alertIcon}"></i>
                    </div>
                    <div class="alert-content">
                        <h6>${alertTitle}</h6>
                        <p>${alertMessage}</p>
                    </div>
                    <div class="alert-meta">
                        <div class="alert-time">${timeString}</div>
                        <div class="alert-indicator">
                            <div class="pulse-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            
            // Animate the alert update
            const newAlert = alertsContainer.querySelector('.alert-update');
            if (newAlert) {
                newAlert.classList.add('alert-slide-in');
                setTimeout(() => {
                    newAlert.classList.remove('alert-update', 'alert-slide-in');
                }, 500);
            }
        }
    }

    // Show real-time update indicator
    function showRealTimeUpdateIndicator(changes) {
        // Add subtle card glow effect
        document.querySelectorAll('.stat-card').forEach(card => {
            card.style.transform = 'translateY(-2px)';
            setTimeout(() => {
                card.style.transform = '';
            }, 300);
        });
    }

    // Update charts (keep your existing chart functions)
    function updateCharts() {
        fetch('/api/sensor-data/?hours=24')
            .then(response => response.json())
            .then(data => {
                if (Array.isArray(data) && data.length > 0) {
                    createTemperatureHumidityChart(data);
                    createEnvironmentalChart(data);
                    
                    // Update chart stats
                    const avgTemp = data.reduce((sum, d) => sum + d.temperature, 0) / data.length;
                    const avgHumidity = data.reduce((sum, d) => sum + d.humidity, 0) / data.length;
                    
                    document.getElementById('avg-temp').textContent = avgTemp.toFixed(1) + '°C';
                    document.getElementById('avg-humidity').textContent = avgHumidity.toFixed(1) + '%';
                    document.getElementById('data-points').textContent = data.length;
                }
            })
            .catch(error => console.error('Error fetching chart data:', error));
    }

    function createTemperatureHumidityChart(data) {
        const timestamps = data.map(d => new Date(d.timestamp));
        const temperatures = data.map(d => d.temperature);
        const humidities = data.map(d => d.humidity);

        const trace1 = {
            x: timestamps,
            y: temperatures,
            type: 'scatter',
            mode: 'lines',
            name: 'Temperature (°C)',
            line: {color: '#ff6b6b', width: 3, shape: 'spline'}
        };

        const trace2 = {
            x: timestamps,
            y: humidities,
            type: 'scatter',
            mode: 'lines',
            name: 'Humidity (%)',
            yaxis: 'y2',
            line: {color: '#4facfe', width: 3, shape: 'spline'}
        };

        const layout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: {color: '#2d3748', family: 'Inter, sans-serif'},
            xaxis: {
                title: 'Time',
                gridcolor: 'rgba(0,0,0,0.1)',
                linecolor: 'rgba(0,0,0,0.2)',
                tickfont: {size: 11}
            },
            yaxis: {
                title: 'Temperature (°C)', 
                side: 'left',
                gridcolor: 'rgba(0,0,0,0.1)',
                linecolor: 'rgba(0,0,0,0.2)',
                tickfont: {size: 11}
            },
            yaxis2: {
                title: 'Humidity (%)',
                side: 'right',
                overlaying: 'y',
                gridcolor: 'rgba(0,0,0,0.1)',
                linecolor: 'rgba(0,0,0,0.2)',
                tickfont: {size: 11}
            },
            legend: {
                orientation: 'h',
                x: 0,
                y: 1.1,
                font: {size: 12}
            },
            margin: {t: 30, l: 60, r: 60, b: 60},
            hovermode: 'closest'
        };

        if (typeof Plotly !== 'undefined') {
            Plotly.newPlot('temperature-humidity-chart', [trace1, trace2], layout, {
                displayModeBar: false,
                responsive: true
            });
        }
    }

    function createEnvironmentalChart(data) {
        const timestamps = data.map(d => new Date(d.timestamp));
        const heatIndex = data.map(d => d.heat_index || d.temperature * 0.9);
        const dewPoint = data.map(d => d.dew_point || d.temperature * 0.8);

        const trace1 = {
            x: timestamps,
            y: heatIndex,
            type: 'scatter',
            mode: 'lines',
            name: 'Heat Index (°C)',
            line: {color: '#f39c12', width: 3, shape: 'spline'}
        };

        const trace2 = {
            x: timestamps,
            y: dewPoint,
            type: 'scatter',
            mode: 'lines',
            name: 'Dew Point (°C)',
            line: {color: '#9b59b6', width: 3, shape: 'spline'}
        };

        const layout = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: {color: '#2d3748', family: 'Inter, sans-serif'},
            xaxis: {
                title: 'Time',
                gridcolor: 'rgba(0,0,0,0.1)',
                linecolor: 'rgba(0,0,0,0.2)',
                tickfont: {size: 11}
            },
            yaxis: {
                title: 'Temperature (°C)',
                gridcolor: 'rgba(0,0,0,0.1)',
                linecolor: 'rgba(0,0,0,0.2)',
                tickfont: {size: 11}
            },
            legend: {
                orientation: 'h',
                x: 0,
                y: 1.1,
                font: {size: 12}
            },
            margin: {t: 30, l: 60, r: 40, b: 60},
            hovermode: 'closest'
        };

        if (typeof Plotly !== 'undefined') {
            Plotly.newPlot('environmental-chart', [trace1, trace2], layout, {
                displayModeBar: false,
                responsive: true
            });
        }
    }

    // Generate sample predictions
    function generateSamplePredictions(button) {
        try {
            const originalText = button ? button.innerHTML : null;
            if (button) {
                button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Activating AI...';
                button.disabled = true;
            }

            fetch('/api/generate-sample-predictions/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data && data.success) {
                    // Show success animation before reload
                    button.innerHTML = '<i class="fas fa-check me-2"></i> AI Activated!';
                    button.classList.add('btn-success');
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    alert('Error generating predictions: ' + (data && data.error ? data.error : 'unknown'));
                    if (button) {
                        button.innerHTML = originalText;
                        button.disabled = false;
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error generating predictions');
                if (button) {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            });
        } catch (e) {
            console.error('generateSamplePredictions error', e);
        }
    }

    // Helper function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Create prediction charts if predictions are available
    function createPredictionCharts() {
        try {
            const predsAvailableEl = document.getElementById('predictions_available');
            const tempPredsEl = document.getElementById('temperature_predictions');
            const humPredsEl = document.getElementById('humidity_predictions');

            const predictionsAvailable = predsAvailableEl ? JSON.parse(predsAvailableEl.textContent) : false;
            const temperaturePredictions = tempPredsEl ? JSON.parse(tempPredsEl.textContent) : [];
            const humidityPredictions = humPredsEl ? JSON.parse(humPredsEl.textContent) : [];

            if (!(predictionsAvailable && temperaturePredictions.length)) {
                return;
            }

            // Build arrays for temperature predictions
            const tempPredictionTimes = temperaturePredictions.map(p => {
                try {
                    const d = new Date(p.prediction_for);
                    if (!isNaN(d)) return d;
                } catch (e) {}
                return p.prediction_for;
            });
            const tempPredictionValues = temperaturePredictions.map(p => p.predicted_value);

            // Update prediction range
            const tempMin = Math.min(...tempPredictionValues);
            const tempMax = Math.max(...tempPredictionValues);
            document.getElementById('temp-prediction-range').textContent = 
                `${tempMin.toFixed(1)}°C to ${tempMax.toFixed(1)}°C`;

            const tempTrace = {
                x: tempPredictionTimes,
                y: tempPredictionValues,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Predicted Temperature',
                line: {color: '#ff6b6b', width: 4, shape: 'spline'},
                marker: {size: 6, color: '#ff6b6b'}
            };

            const tempLayout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {color: '#2d3748', family: 'Inter, sans-serif'},
                xaxis: {
                    title: 'Time',
                    gridcolor: 'rgba(0,0,0,0.1)',
                    tickfont: {size: 11}
                },
                yaxis: {
                    title: 'Temperature (°C)',
                    gridcolor: 'rgba(0,0,0,0.1)',
                    tickfont: {size: 11}
                },
                showlegend: false,
                margin: {t: 30, l: 60, r: 40, b: 60}
            };

            if (typeof Plotly !== 'undefined') {
                Plotly.newPlot('temperature-predictions-chart', [tempTrace], tempLayout, {
                    displayModeBar: false,
                    responsive: true
                });
            }

            // Humidity predictions chart
            const humidityPredictionTimes = humidityPredictions.map(p => {
                try {
                    const d = new Date(p.prediction_for);
                    if (!isNaN(d)) return d;
                } catch (e) {}
                return p.prediction_for;
            });
            const humidityPredictionValues = humidityPredictions.map(p => p.predicted_value);

            // Update prediction range
            const humidityMin = Math.min(...humidityPredictionValues);
            const humidityMax = Math.max(...humidityPredictionValues);
            document.getElementById('humidity-prediction-range').textContent = 
                `${humidityMin.toFixed(1)}% to ${humidityMax.toFixed(1)}%`;

            const humidityTrace = {
                x: humidityPredictionTimes,
                y: humidityPredictionValues,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Predicted Humidity',
                line: {color: '#4facfe', width: 4, shape: 'spline'},
                marker: {size: 6, color: '#4facfe'}
            };

            const humidityLayout = {
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: {color: '#2d3748', family: 'Inter, sans-serif'},
                xaxis: {
                    title: 'Time',
                    gridcolor: 'rgba(0,0,0,0.1)',
                    tickfont: {size: 11}
                },
                yaxis: {
                    title: 'Humidity (%)',
                    gridcolor: 'rgba(0,0,0,0.1)',
                    tickfont: {size: 11}
                },
                showlegend: false,
                margin: {t: 30, l: 60, r: 40, b: 60}
            };

            if (typeof Plotly !== 'undefined') {
                Plotly.newPlot('humidity-predictions-chart', [humidityTrace], humidityLayout, {
                    displayModeBar: false,
                    responsive: true
                });
            }
        } catch (e) {
            console.error('createPredictionCharts error', e);
        }
    }

    // Initialize and update periodically
    document.addEventListener('DOMContentLoaded', function() {
        try {
            console.log('🏁 Ultimate Professional Dashboard initializing...');
            
            // Hide loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                setTimeout(() => {
                    loadingOverlay.style.opacity = '0';
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                    }, 500);
                }, 1500);
            }
            
            // Start time updates
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Initial load
            updateCurrentStats();
            updateCharts();
            createPredictionCharts();
            
            console.log('✅ Ultimate dashboard ready - updating every 3 seconds');
            
        } catch (initErr) {
            console.error('❌ Init error:', initErr);
        }

        // Update more frequently for real-time feel
        setInterval(() => updateCurrentStats(), 3000); // Every 3 seconds
        setInterval(updateCharts, 30000); // Every 30 seconds
        
        // Also update when page becomes visible
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                updateCurrentStats();
                updateCharts();
            }
        });
    });
</script>
{% endblock %}


